import{i as y}from"./axios-D3XPDuSg.js";import{r as i,v as $,V,F as C,W as D,e as j,f as R,w as o,u as t,q as G,g as K,o as O,i as l,a as z,k,A as m,B as v,m as x,S as W,T as H,s as J,x as Q,z as c,K as X,G as f}from"./index-C_mfyI4l.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{A as Z}from"./AlertCircleOutline-DXBUTj2G.js";const ee={class:"table-responsive"},ae={class:"text-lg font-bold m-0"},se={__name:"DashboardDoctors",setup(te){const h=i([]),_=i(!1),n=i(!1),U=i(!1),p=$(),P=V(),N=i(null),u=i(null),A=K(),r=i({name:"",email:"",sheet_identifier:"",password:"",password_confirmation:""}),F=C(()=>({name:[{required:!0,message:"Name is required",trigger:["input","blur"]}],email:[{required:!0,message:"Email is required",trigger:["input","blur"]},{type:"email",message:"Invalid email",trigger:["input","blur"]}],sheet_identifier:[{required:!0,message:"The sheet identifier is required",trigger:["input","blur"]}],password:u.value?[]:[{required:!0,min:6,message:"Password must be at least 6 characters",trigger:["input","blur"]}],password_confirmation:u.value?[]:[{validator:(a,e)=>e===r.value.password,message:"Passwords do not match",trigger:["input","blur"]}]})),q=[{title:"Name",key:"name"},{title:"Email",key:"email"},{title:"Actions",key:"actions",render(a){return f("div",{style:"display: flex; gap: 8px;"},[f(v,{size:"small",type:"info",secondary:!0,onClick:()=>S(a)},{default:()=>"Edit"}),f(v,{size:"small",type:"primary",secondary:!0,onClick:()=>B(a.id)},{default:()=>"Prescriptions"}),f(v,{size:"small",type:"error",secondary:!0,onClick:()=>T(a.id)},{default:()=>"Delete"})])}}],b=async()=>{try{_.value=!0;const a=await y.get("/users");h.value=a.data}catch{p.error("Failed to load users")}finally{_.value=!1}},L=async()=>{var a;try{await((a=N.value)==null?void 0:a.validate()),U.value=!0;const e={name:r.value.name,email:r.value.email,sheet_identifier:r.value.sheet_identifier,...r.value.password?{password:r.value.password,password_confirmation:r.value.password_confirmation}:{}};u.value?(await y.put(`/users/${u.value}`,e),p.success("User updated successfully!")):(await y.post("/users",{...e,is_admin:!1}),p.success("User added successfully!")),n.value=!1,b()}catch{p.error("Failed to save user")}finally{U.value=!1}},S=a=>{u.value=a.id,r.value={name:a.name,email:a.email,sheet_identifier:a.sheet_identifier,password:"",password_confirmation:""},n.value=!0},T=a=>{P.warning({title:"Delete User",content:"Are you sure you want to delete this user? This action cannot be undone.",positiveText:"Delete",negativeText:"Cancel",positiveButtonProps:{type:"error"},icon:()=>f(Z,{style:"color: red; font-size: 22px;"}),onPositiveClick:async()=>{try{await y.delete(`/users/${a}`),p.success("User deleted successfully!"),b()}catch{p.error("Failed to delete user")}}})},B=a=>{A.push(`/dashboard/doctors/${a}/prescriptions`)},E=()=>{r.value={name:"",email:"",sheet_identifier:"",password:"",password_confirmation:""},u.value=null};D(n,a=>{a||E()});const d=i(""),w=i(1),g=i(5),I=C(()=>{const a=h.value.filter(s=>s.name.toLowerCase().includes(d.value.toLowerCase())||s.email.toLowerCase().includes(d.value.toLowerCase())),e=(w.value-1)*g.value;return a.slice(e,e+g.value)}),M=C(()=>h.value.filter(a=>a.name.toLowerCase().includes(d.value.toLowerCase())||a.email.toLowerCase().includes(d.value.toLowerCase())).length);return D(d,()=>{w.value=1}),j(b),(a,e)=>(O(),R(t(G),{title:"Manage Doctors"},{default:o(()=>[l(t(k),{justify:"space-between",align:"center",class:"mb-4"},{default:o(()=>[l(t(m),{value:d.value,"onUpdate:value":e[0]||(e[0]=s=>d.value=s),placeholder:"Search doctors...",clearable:"",style:{"max-width":"300px"}},null,8,["value"]),l(t(v),{type:"primary",onClick:e[1]||(e[1]=s=>n.value=!0)},{default:o(()=>e[11]||(e[11]=[x(" Add Doctor ")])),_:1,__:[11]})]),_:1}),z("div",ee,[l(t(W),{columns:q,data:I.value,loading:_.value,bordered:!0,striped:""},null,8,["data","loading"])]),l(t(k),{justify:"end",class:"mt-4"},{default:o(()=>[l(t(H),{page:w.value,"onUpdate:page":e[2]||(e[2]=s=>w.value=s),"page-size":g.value,"onUpdate:pageSize":e[3]||(e[3]=s=>g.value=s),"item-count":M.value,"show-size-picker":"","page-sizes":[5,10,20]},null,8,["page","page-size","item-count"])]),_:1}),l(t(J),{show:n.value,"onUpdate:show":e[10]||(e[10]=s=>n.value=s),preset:"card",style:{width:"500px"}},{header:o(()=>[z("h2",ae,X(u.value?"Edit Doctor":"Add New Doctor"),1)]),default:o(()=>[l(t(Q),{ref_key:"addUserFormRef",ref:N,model:r.value,rules:F.value,"label-width":"120px",size:"large"},{default:o(()=>[l(t(c),{label:"Name",path:"name"},{default:o(()=>[l(t(m),{value:r.value.name,"onUpdate:value":e[4]||(e[4]=s=>r.value.name=s),placeholder:"User name"},null,8,["value"])]),_:1}),l(t(c),{label:"Email",path:"email"},{default:o(()=>[l(t(m),{value:r.value.email,"onUpdate:value":e[5]||(e[5]=s=>r.value.email=s),placeholder:"User email"},null,8,["value"])]),_:1}),l(t(c),{label:"Sheet Identifier",path:"sheet"},{default:o(()=>[l(t(m),{value:r.value.sheet_identifier,"onUpdate:value":e[6]||(e[6]=s=>r.value.sheet_identifier=s),placeholder:"User sheet identifier"},null,8,["value"])]),_:1}),l(t(c),{label:"Password",path:"password"},{default:o(()=>[l(t(m),{value:r.value.password,"onUpdate:value":e[7]||(e[7]=s=>r.value.password=s),type:"password",placeholder:"Password","show-password-on":"click"},null,8,["value"])]),_:1}),l(t(c),{label:"Confirm Password",path:"password_confirmation"},{default:o(()=>[l(t(m),{value:r.value.password_confirmation,"onUpdate:value":e[8]||(e[8]=s=>r.value.password_confirmation=s),type:"password",placeholder:"Confirm Password","show-password-on":"click"},null,8,["value"])]),_:1}),l(t(k),{justify:"end",class:"mt-6"},{default:o(()=>[l(t(v),{onClick:e[9]||(e[9]=s=>n.value=!1)},{default:o(()=>e[12]||(e[12]=[x("Cancel")])),_:1,__:[12]}),l(t(v),{type:"primary",loading:U.value,onClick:L},{default:o(()=>e[13]||(e[13]=[x(" Save ")])),_:1,__:[13]},8,["loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show"])]),_:1}))}},ne=Y(se,[["__scopeId","data-v-bf3b9ee0"]]);export{ne as default};
